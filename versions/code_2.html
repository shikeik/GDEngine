<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>æ ¼æ–—å¤©æ‰Ver2.0</title>
    <style>
        body { 
            margin: 0; background: #111; overflow: hidden; font-family: 'Segoe UI', sans-serif; 
            touch-action: none; user-select: none; -webkit-user-select: none;
        }
        
        #game-container {
            position: relative; width: 100vw; height: 100vh;
            display: flex; justify-content: center; align-items: center; background: #222;
        }

        canvas { background: #333; border-top: 2px solid #00d2ff; border-bottom: 2px solid #00d2ff; }

        /* UIå±‚ */
        #ui-layer { position: absolute; top: 10px; width: 95%; display: flex; justify-content: space-between; z-index: 10; pointer-events: none; }
        .bar-container { width: 40%; height: 20px; background: #555; border: 2px solid #fff; transform: skewX(-20deg); overflow: hidden; }
        .hp-bar { height: 100%; transition: width 0.2s; }
        #p1-bar { background: #00ff00; width: 100%; float: right; } /* ç©å®¶è¡€æ¡ä»å³å¾€å·¦å‡ */
        #p2-bar { background: #ff0000; width: 100%; float: left; }

        /* ç»“ç®—å¼¹çª— */
        #overlay {
            position: absolute; top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(0,0,0,0.85); z-index: 50;
            display: flex; flex-direction: column; justify-content: center; align-items: center;
        }
        #overlay h1 { color: #fff; font-size: 40px; margin-bottom: 20px; text-shadow: 0 0 10px #00d2ff; }
        .btn-style {
            padding: 15px 40px; font-size: 24px; background: #00d2ff; color: #000; border: none;
            border-radius: 5px; cursor: pointer; font-weight: bold; box-shadow: 0 0 15px #00d2ff;
        }
        .btn-style:active { transform: scale(0.95); background: #fff; }

        /* è™šæ‹Ÿæ‰‹æŸ„ */
        .controls {
            position: absolute; bottom: 20px; width: 100%; height: 140px; pointer-events: none;
            display: flex; justify-content: space-between; padding: 0 30px; box-sizing: border-box; z-index: 20;
        }
        .btn-group { display: flex; gap: 20px; pointer-events: auto; align-items: flex-end; }
        .d-pad { width: 70px; height: 70px; background: rgba(255,255,255,0.1); border: 2px solid rgba(255,255,255,0.3); border-radius: 50%; display: flex; justify-content: center; align-items: center; color: white; font-size: 30px; }
        .act-btn { width: 80px; height: 80px; border-radius: 50%; display: flex; justify-content: center; align-items: center; font-size: 30px; font-weight: bold; border: 2px solid white; }
        #btn-atk { background: rgba(255, 50, 50, 0.4); }
        #btn-jump { background: rgba(50, 50, 255, 0.4); }
        .pressed { background: rgba(255,255,255,0.4) !important; transform: scale(0.9); }

        /* æ—‹è½¬æç¤º */
        #rotate-tip {
            display: none; position: absolute; top:0; left:0; width:100%; height:100%;
            background: #000; color: #00d2ff; z-index: 100;
            flex-direction: column; justify-content: center; align-items: center; text-align: center;
        }
        @media screen and (orientation: portrait) { #rotate-tip { display: flex; } }
    </style>
</head>
<body>

    <div id="rotate-tip">
        <h1>ğŸ“± è¯·æ¨ªå±æ¸¸ç©</h1>
        <p>Turn Device Landscape</p>
    </div>

    <div id="game-container">
        <!-- ç»“ç®—/å¼€å§‹ ç•Œé¢ -->
        <div id="overlay">
            <h1 id="msg-title">READY?</h1>
            <button id="start-btn" class="btn-style">ğŸ”¥ è¿›å…¥å…¨å±å¼€æˆ˜</button>
        </div>

        <!-- è¡€æ¡UI -->
        <div id="ui-layer">
            <div class="bar-container" style="border-color: #00ff00"><div id="p1-bar" class="hp-bar"></div></div>
            <div style="color:white; font-weight:bold; font-size:24px;">VS</div>
            <div class="bar-container" style="border-color: #ff0000"><div id="p2-bar" class="hp-bar"></div></div>
        </div>
        
        <canvas id="gameCanvas"></canvas>

        <div class="controls">
            <div class="btn-group">
                <div class="d-pad" id="btn-left">â¬…ï¸</div>
                <div class="d-pad" id="btn-right">â¡ï¸</div>
            </div>
            <div class="btn-group">
                <div class="act-btn" id="btn-atk">ğŸ¥Š</div>
                <div class="act-btn" id="btn-jump">ğŸš€</div>
            </div>
        </div>
    </div>

    <script>
        const canvas = document.getElementById('gameCanvas');
        const ctx = canvas.getContext('2d');
        const overlay = document.getElementById('overlay');
        const title = document.getElementById('msg-title');
        const startBtn = document.getElementById('start-btn');
        
        // æ¸¸æˆçŠ¶æ€
        let gameRunning = false;
        let p1, p2;
        const keys = { l: false, r: false };

        // æ ¸å¿ƒç±»
        class Fighter {
            constructor(x, color, isAi = false) {
                this.startX = x; this.color = color; this.isAi = isAi;
                this.reset();
            }

            reset() {
                this.x = this.startX; this.y = 200; 
                this.w = 50; this.h = 100;
                this.dy = 0; this.health = 100;
                this.isAttacking = false;
                this.dir = this.isAi ? -1 : 1; // 1:å³, -1:å·¦
                this.speed = 5;
                this.dead = false;
            }

            update(target) {
                if (this.dead) return;

                // é‡åŠ›
                this.y += this.dy;
                if (this.y + this.h + this.dy >= canvas.height - 20) {
                    this.dy = 0; this.y = canvas.height - 20 - this.h;
                } else { this.dy += 0.8; }

                // ç©å®¶ç§»åŠ¨ä¸æœå‘é€»è¾‘
                if (!this.isAi) {
                    if (keys.r && this.x < canvas.width - this.w) { this.x += this.speed; this.dir = 1; }
                    if (keys.l && this.x > 0) { this.x -= this.speed; this.dir = -1; }
                } 
                // AI é€»è¾‘
                else {
                    let dist = Math.abs(this.x - target.x);
                    // ç®€å•çš„AIæœå‘åˆ¤æ–­
                    this.dir = target.x > this.x ? 1 : -1;
                    
                    if (dist > 60) this.x += 3 * this.dir; // è¿½å‡»
                    else if (dist < 100 && Math.random() < 0.04) this.attack(target); // æ”»å‡»
                    if (target.y < this.y - 50 && this.dy === 0 && Math.random() < 0.05) this.dy = -15; // è·³è·ƒ
                }

                this.draw();
            }

            draw() {
                ctx.save();
                // èº«ä½“
                ctx.fillStyle = this.color;
                ctx.fillRect(this.x, this.y, this.w, this.h);
                
                // çœ¼ç› (æŒ‡ç¤ºæœå‘)
                ctx.fillStyle = 'white';
                let eyeX = this.dir === 1 ? this.x + 30 : this.x + 10;
                ctx.fillRect(eyeX, this.y + 20, 10, 10);

                // æ”»å‡»ç‰¹æ•ˆ
                if (this.isAttacking) {
                    ctx.fillStyle = 'yellow';
                    // æ ¹æ®æœå‘è®¡ç®—æ”»å‡»åˆ¤å®šæ¡†
                    let atkX = this.dir === 1 ? this.x + this.w : this.x - 60;
                    ctx.fillRect(atkX, this.y + 35, 60, 30);
                }
                ctx.restore();
            }

            attack(target) {
                if (this.isAttacking || this.dead) return;
                this.isAttacking = true;
                setTimeout(() => this.isAttacking = false, 150);

                // å‘½ä¸­åˆ¤å®š
                let atkX = this.dir === 1 ? this.x + this.w : this.x - 60;
                let atkW = 60;

                // ç®€å•çš„çŸ©å½¢ç¢°æ’
                if (atkX < target.x + target.w && atkX + atkW > target.x &&
                    this.y + 35 < target.y + target.h && this.y + 65 > target.y) {
                    
                    target.health -= 10;
                    if(target.health <= 0) {
                        target.health = 0;
                        target.dead = true;
                        endGame(this.isAi ? "YOU LOSE..." : "K.O.! YOU WIN!");
                    }
                    updateBars();
                }
            }
        }

        // åˆå§‹åŒ–
        function init() {
            p1 = new Fighter(100, '#00ff00');
            p2 = new Fighter(600, '#ff0000', true);
            updateBars();
            animate();
        }

        function updateBars() {
            document.getElementById('p1-bar').style.width = p1.health + '%';
            document.getElementById('p2-bar').style.width = p2.health + '%';
        }

        function endGame(msg) {
            gameRunning = false;
            title.innerText = msg;
            startBtn.innerText = "ğŸ”„ å†æ¥ä¸€å±€";
            overlay.style.display = 'flex';
        }

        function resetGame() {
            p1.reset();
            p2.reset();
            updateBars();
            overlay.style.display = 'none';
            gameRunning = true;
        }

        function animate() {
            requestAnimationFrame(animate);
            
            // å“åº”å¼ç”»å¸ƒ
            canvas.width = window.innerWidth;
            canvas.height = window.innerHeight;
            
            ctx.fillStyle = '#222';
            ctx.fillRect(0, 0, canvas.width, canvas.height);
            
            // åœ°é¢
            ctx.fillStyle = '#111';
            ctx.fillRect(0, canvas.height - 20, canvas.width, 20);

            if (p1 && p2) {
                p1.update(p2);
                p2.update(p1);
            }
        }

        // --- è§¦æ§é€»è¾‘ä¼˜åŒ– ---
        function bindTouch(id, actionDown, actionUp) {
            const btn = document.getElementById(id);
            const start = (e) => { e.preventDefault(); btn.classList.add('pressed'); actionDown(); };
            const end = (e) => { e.preventDefault(); btn.classList.remove('pressed'); actionUp(); };
            
            btn.addEventListener('touchstart', start, {passive: false});
            btn.addEventListener('touchend', end, {passive: false});
            btn.addEventListener('mousedown', start);
            btn.addEventListener('mouseup', end);
        }

        bindTouch('btn-left', () => keys.l = true, () => keys.l = false);
        bindTouch('btn-right', () => keys.r = true, () => keys.r = false);
        bindTouch('btn-jump', () => { if(p1.dy === 0) p1.dy = -18; }, () => {});
        bindTouch('btn-atk', () => p1.attack(p2), () => {});

        // --- å…¨å±ä¸é‡å¼€é€»è¾‘ ---
        startBtn.addEventListener('click', async () => {
            // å°è¯•å…¨å±
            if (!document.fullscreenElement) {
                try {
                    await document.documentElement.requestFullscreen();
                    // å°è¯•é”å®šæ¨ªå± (å®‰å“Chromeæœ‰æ•ˆï¼ŒiOS Safarié€šå¸¸ä¼šå¿½ç•¥æˆ–éœ€è¦WebAPPé…ç½®)
                    if (screen.orientation && screen.orientation.lock) {
                        await screen.orientation.lock("landscape");
                    }
                } catch(e) { console.log("å…¨å±/æ—‹è½¬è¢«æµè§ˆå™¨æ‹¦æˆª:", e); }
            }
            resetGame();
        });

        init();

    </script>
</body>
</html>