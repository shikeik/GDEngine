<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Â§©ÊâçÊ†ºÊñóÔºöÊúÄÁªàÂÆåÁæéÁâà</title>
    <style>
        body { margin: 0; background: #050505; overflow: hidden; font-family: 'Segoe UI', sans-serif; touch-action: none; user-select: none; -webkit-user-select: none; }
        #game-container { position: absolute; top: 0; left: 0; width: 100%; height: 100%; background: radial-gradient(circle at center, #1a1a2e 0%, #000 100%); }
        canvas { display: block; width: 100%; height: 100%; }

        /* HUD ÁïåÈù¢ */
        #hud { position: absolute; top: 10px; width: 94%; left: 3%; display: flex; justify-content: space-between; pointer-events: none; z-index: 10; }
        .char-hud { width: 45%; display: flex; flex-direction: column; gap: 5px; position: relative; }
        .bar-frame { height: 12px; background: rgba(0,0,0,0.8); border: 1px solid #555; transform: skewX(-20deg); position: relative; overflow: hidden; }
        .hp-fill { height: 100%; width: 100%; transition: width 0.1s; }
        .mp-fill { height: 100%; width: 0%; background: #00d2ff; box-shadow: 0 0 10px #00d2ff; transition: width 0.1s; }
        
        #p1-hp { background: linear-gradient(90deg, #ffaa00, #ff3300); float: right; }
        #p2-hp { background: #ff0000; float: left; }
        #p1-mp-frame { width: 80%; align-self: flex-end; height: 8px; border-color: #00d2ff; }

        /* ËøûÂáªÊòæÁ§∫ */
        .combo-text { 
            position: absolute; top: 60px; font-weight: 900; font-style: italic; 
            font-size: 40px; opacity: 0; transition: transform 0.1s;
            text-shadow: 2px 2px 0px #000; z-index: 15;
        }
        #p1-combo { left: 5%; color: #ffaa00; text-align: left; }
        #p2-combo { right: 5%; color: #ff3333; text-align: right; }
        .combo-pop { animation: popScale 0.2s; opacity: 1 !important; }
        @keyframes popScale { 0% { transform: scale(1); } 50% { transform: scale(1.5); } 100% { transform: scale(1); } }

        /* ÊµÆÂä®‰º§ÂÆ≥Êï∞Â≠ó */
        .dmg-text { position: absolute; color: #fff; font-weight: 900; font-size: 24px; text-shadow: 0 0 5px red; animation: floatUp 0.8s forwards; pointer-events: none; z-index: 12; }
        @keyframes floatUp { 0% { opacity: 1; transform: translateY(0) scale(1); } 100% { opacity: 0; transform: translateY(-50px) scale(1.5); } }

        /* ÂêØÂä®/ÁªìÁÆóÂ±Ç */
        #overlay { position: absolute; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.92); z-index: 100; display: flex; flex-direction: column; justify-content: center; align-items: center; }
        #title-text { color:#fff; font-size: 40px; margin-bottom:10px; text-shadow:0 0 20px #00f2ff; font-weight: bold; font-style: italic; }
        #sub-text { color:#aaa; margin-bottom: 30px; font-size: 18px; }
        #start-btn { padding: 15px 50px; font-size: 22px; font-weight: bold; color: #00f2ff; background: transparent; border: 2px solid #00f2ff; border-radius: 30px; box-shadow: 0 0 20px rgba(0,242,255,0.3); animation: pulse 1.5s infinite; }
        @keyframes pulse { 0% { box-shadow: 0 0 20px rgba(0,242,255,0.3); } 50% { box-shadow: 0 0 40px rgba(0,242,255,0.6); } 100% { box-shadow: 0 0 20px rgba(0,242,255,0.3); } }

        /* ËôöÊãüÊåâÈîÆ */
        .controls { position: absolute; bottom: 20px; width: 100%; padding: 0 30px; display: flex; justify-content: space-between; box-sizing: border-box; pointer-events: none; z-index: 20; }
        .c-group { display: flex; gap: 15px; pointer-events: auto; align-items: flex-end; }
        .btn { width: 65px; height: 65px; border-radius: 50%; background: rgba(255,255,255,0.1); border: 2px solid rgba(255,255,255,0.3); backdrop-filter: blur(4px); display: flex; justify-content: center; align-items: center; color: white; font-size: 24px; }
        .btn:active, .btn.pressed { background: rgba(255,255,255,0.3); transform: scale(0.92); border-color: #fff; }
        
        #btn-atk { width: 80px; height: 80px; background: rgba(255, 50, 50, 0.2); border-color: #ff3333; font-size: 36px; }
        #btn-ult { width: 50px; height: 50px; background: rgba(0, 210, 255, 0.2); border-color: #00d2ff; font-size: 16px; margin-bottom: 20px; display: none; }
        #btn-dash { font-size: 16px; background: rgba(255,255,0,0.1); }
        .ult-ready { display: flex !important; animation: shake 0.5s infinite; box-shadow: 0 0 15px #00d2ff; }
        @keyframes shake { 0% { transform: translate(1px, 1px); } 50% { transform: translate(-1px, -1px); } 100% { transform: translate(1px, 1px); } }

    </style>
</head>
<body>

    <div id="game-container">
        <!-- ÁªìÁÆó/ÂºÄÂßãÁïåÈù¢ -->
        <div id="overlay">
            <div id="title-text">CYBER FIGHT</div>
            <div id="sub-text">ÂáÜÂ§áÂ•Ω‰Ω†ÁöÑÊâãÊåá‰∫ÜÂêóÔºü</div>
            <button id="start-btn">‚ö° ÂÖ®Â±èÂºÄÊàò</button>
        </div>

        <!-- HUD -->
        <div id="hud">
            <div class="char-hud">
                <div class="bar-frame" style="height:15px"><div id="p1-hp" class="hp-fill"></div></div>
                <div class="bar-frame" id="p1-mp-frame"><div id="p1-mp" class="mp-fill"></div></div>
                <div id="p1-combo" class="combo-text"></div>
            </div>
            <div class="char-hud">
                <div class="bar-frame" style="height:15px"><div id="p2-hp" class="hp-fill"></div></div>
                <div id="p2-combo" class="combo-text"></div>
            </div>
        </div>

        <canvas id="canvas"></canvas>

        <div class="controls">
            <div class="c-group">
                <div class="btn" id="left">‚¨ÖÔ∏è</div>
                <div class="btn" id="right">‚û°Ô∏è</div>
            </div>
            <div class="c-group" style="align-items: flex-end;">
                <div class="btn" id="btn-ult">‚ö°</div>
                <div class="btn" id="btn-dash">üí®</div>
                <div class="btn" id="btn-atk">üëä</div>
                <div class="btn" id="btn-jump">üöÄ</div>
            </div>
        </div>
    </div>

    <script>
        const canvas = document.getElementById('canvas');
        const ctx = canvas.getContext('2d');
        const overlay = document.getElementById('overlay');
        const startBtn = document.getElementById('start-btn');
        const titleText = document.getElementById('title-text');
        const subText = document.getElementById('sub-text');
        const btnUlt = document.getElementById('btn-ult');

        // ÈúáÂä®‰∏éÁ≤íÂ≠ê
        let shake = 0;
        let particles = [];
        
        // Ê†∏ÂøÉÂèòÈáè
        let p1, p2;
        const keys = { l: false, r: false };
        let gameActive = false;

        class Particle {
            constructor(x, y, color, speed) {
                this.x = x; this.y = y; this.color = color;
                this.vx = (Math.random() - 0.5) * speed;
                this.vy = (Math.random() - 0.5) * speed;
                this.life = 1.0;
            }
            update() {
                this.x += this.vx; this.y += this.vy;
                this.life -= 0.05;
            }
            draw() {
                ctx.globalAlpha = this.life;
                ctx.fillStyle = this.color;
                ctx.fillRect(this.x, this.y, 4, 4);
                ctx.globalAlpha = 1;
            }
        }

        class Fighter {
            constructor(x, color, isAi) {
                this.startPos = x; this.c = color; this.isAi = isAi;
                this.reset();
            }
            reset() {
                this.x = this.startPos; this.y = 200; this.w = 50; this.h = 90;
                this.vx = 0; this.vy = 0;
                this.maxHp = 300; // <--- ‰øÆÊîπÁÇπÔºöË°ÄÈáèÂä†Âéö3ÂÄç
                this.hp = this.maxHp; 
                this.mp = 0;
                this.dir = this.isAi ? -1 : 1;
                this.combo = 0; 
                this.hitStreak = 0; // ËøûÂáªËÆ°Êï∞
                this.lastHitTime = 0;
                this.lastAtkTime = 0;
                this.isDash = false;
                this.state = 'idle'; 
            }
            
            update(target) {
                if(this.state === 'dead') return;

                // ËøûÂáª‰∏≠Êñ≠ÈÄªËæë (2ÁßíÊ≤°Êâì‰∏≠Â∞±Êñ≠)
                if(Date.now() - this.lastHitTime > 2000 && this.hitStreak > 0) {
                    this.hitStreak = 0;
                    updateComboUI();
                }

                // Áâ©ÁêÜ
                this.y += this.vy;
                this.x += this.vx;
                
                // Êë©Êì¶Âäõ
                if(!this.isDash) this.vx *= 0.8;
                else this.vx *= 0.9;

                let ground = canvas.height - 100;
                if(this.y + this.h >= ground) { 
                    this.y = ground - this.h; 
                    this.vy = 0; 
                    if(this.state === 'jump') this.state = 'idle';
                } else { 
                    this.vy += 0.9; 
                }

                // ËæπÁïå
                if(this.x < 0) this.x = 0;
                if(this.x > canvas.width - this.w) this.x = canvas.width - this.w;

                // Áä∂ÊÄÅÊú∫
                if(this.state !== 'hit' && this.state !== 'ult') {
                    if(this.isAi) this.aiLogic(target);
                    else this.playerLogic();
                }

                if(this.state === 'ult') {
                    this.vx = 0; this.vy = 0;
                    if(Math.random() < 0.3) createParticles(this.x + this.w/2, this.y + this.h/2, '#00d2ff', 20);
                }

                this.draw();
            }

            playerLogic() {
                if (keys.l) { this.vx = -5; this.dir = -1; if(this.state === 'idle') this.state = 'run'; }
                if (keys.r) { this.vx = 5; this.dir = 1; if(this.state === 'idle') this.state = 'run'; }
                if (!keys.l && !keys.r && this.state === 'run') this.state = 'idle';
            }

            aiLogic(target) {
                let dist = Math.abs(this.x - target.x);
                this.dir = this.x < target.x ? 1 : -1;
                
                if (dist > 70) { this.vx = 3 * this.dir; }
                else {
                    if (Math.random() < 0.02) this.attack(target);
                }
                if (this.hp < this.maxHp * 0.3 && Math.random() < 0.01) this.dash();
            }

            dash() {
                if(this.mp >= 10 || this.isAi) {
                    if(!this.isAi) { this.mp -= 10; updateUI(); }
                    this.isDash = true;
                    this.vx = 15 * this.dir;
                    this.vy = -2; 
                    for(let i=0; i<5; i++) createParticles(this.x, this.y + i*20, '#fff', 2);
                    setTimeout(() => { this.isDash = false; }, 200);
                }
            }

            attack(target) {
                if(this.state === 'attack' || this.state === 'hit' || this.state === 'ult') return;
                
                let now = Date.now();
                if(now - this.lastAtkTime > 600) this.combo = 0;
                this.lastAtkTime = now;
                this.combo = (this.combo % 3) + 1;

                this.state = 'attack';
                this.vx = 2 * this.dir; 

                // Âä®‰Ωú‰º§ÂÆ≥ÈÖçÁΩÆ
                let damage = 8;
                let range = 60;
                if(this.combo === 3) { damage = 15; range = 80; } 

                setTimeout(() => { this.state = 'idle'; }, 200);

                let hitX = this.dir === 1 ? this.x + this.w : this.x - range;
                
                if(hitX < target.x + target.w && hitX + range > target.x &&
                   this.y < target.y + target.h && this.y + 50 > target.y) {
                    
                    if(this.combo === 3) shake = 10; else shake = 3;
                    createParticles(hitX + range/2, this.y + 40, '#ff0000', 10);
                    
                    // Â¢ûÂä†ËøûÂáªÊï∞
                    this.hitStreak++;
                    this.lastHitTime = Date.now();
                    updateComboUI();

                    target.takeDamage(damage);
                    
                    if(!this.isAi) {
                        this.mp = Math.min(100, this.mp + 15);
                        updateUI();
                    }
                }
            }

            ultimate(target) {
                if(this.mp < 100) return;
                this.mp = 0;
                updateUI();
                this.state = 'ult';
                shake = 20;
                
                setTimeout(() => {
                    ctx.fillStyle = 'white';
                    ctx.fillRect(0,0,canvas.width,canvas.height);
                    
                    if(Math.abs(this.y - target.y) < 100) { 
                        // Â§ßÊãõ‰πüÁÆóËøûÂáª
                        this.hitStreak += 5; 
                        this.lastHitTime = Date.now();
                        updateComboUI();
                        target.takeDamage(40);
                    }
                    this.state = 'idle';
                }, 800);
            }

            takeDamage(amt) {
                this.hp -= amt;
                this.state = 'hit';
                this.vx = -5 * this.dir; 
                showDamage(this.x, this.y, amt);
                
                if(this.hp <= 0) {
                    this.hp = 0;
                    this.state = 'dead';
                    // <--- ‰øÆÊîπÁÇπÔºöÁßªÈô§ alertÔºå‰ΩøÁî®Ê∏∏ÊàèÂÜÖUI
                    endGame(this.isAi ? false : true); 
                }
                
                updateUI();
                setTimeout(() => { if(this.state === 'hit') this.state = 'idle'; }, 300);
            }

            draw() {
                if(this.hp <= 0) return;
                ctx.save();
                
                if(this.state === 'hit') ctx.fillStyle = '#fff';
                else if(this.state === 'ult') ctx.fillStyle = '#00d2ff';
                else ctx.fillStyle = this.c;
                
                if(this.state === 'run') ctx.transform(1, 0, -0.2 * this.dir, 1, 0, 0);
                
                ctx.fillRect(this.x, this.y, this.w, this.h);
                
                ctx.fillStyle = '#fff';
                let eyeX = this.dir===1 ? this.x+30 : this.x+5;
                ctx.fillRect(eyeX, this.y+20, 15, 10);

                if(this.state === 'attack') {
                    ctx.fillStyle = this.combo === 3 ? '#ffaa00' : '#ffff00';
                    let atkX = this.dir===1 ? this.x+this.w : this.x-60;
                    let size = this.combo === 3 ? 50 : 30;
                    ctx.fillRect(atkX, this.y+35, 60, size);
                }

                if(this.state === 'ult') {
                    ctx.strokeStyle = '#00d2ff';
                    ctx.lineWidth = 5;
                    ctx.beginPath();
                    ctx.arc(this.x + this.w/2, this.y + this.h/2, 60 + Math.random()*20, 0, Math.PI*2);
                    ctx.stroke();
                }
                ctx.restore();
            }
        }

        // --- Á≥ªÁªüÂáΩÊï∞ ---
        function createParticles(x, y, color, count) {
            for(let i=0; i<count; i++) particles.push(new Particle(x, y, color, 8));
        }

        function showDamage(x, y, val) {
            let el = document.createElement('div');
            el.className = 'dmg-text';
            el.style.left = x + 'px';
            el.style.top = y + 'px';
            el.innerText = '-' + val;
            document.getElementById('game-container').appendChild(el);
            setTimeout(() => el.remove(), 800);
        }

        function updateUI() {
            document.getElementById('p1-hp').style.width = (p1.hp / p1.maxHp * 100) + '%';
            document.getElementById('p2-hp').style.width = (p2.hp / p2.maxHp * 100) + '%';
            document.getElementById('p1-mp').style.width = p1.mp + '%';
            
            if(p1.mp >= 100) btnUlt.classList.add('ult-ready');
            else btnUlt.classList.remove('ult-ready');
        }

        // <--- ‰øÆÊîπÁÇπÔºöËøûÂáªUIÊõ¥Êñ∞
        function updateComboUI() {
            const c1 = document.getElementById('p1-combo');
            const c2 = document.getElementById('p2-combo');
            
            if(p1.hitStreak > 1) {
                c1.innerText = p1.hitStreak + " COMBO!";
                c1.style.opacity = 1;
                c1.classList.remove('combo-pop');
                void c1.offsetWidth; // trigger reflow
                c1.classList.add('combo-pop');
            } else {
                c1.style.opacity = 0;
            }

            if(p2.hitStreak > 1) {
                c2.innerText = p2.hitStreak + " COMBO!";
                c2.style.opacity = 1;
                c2.classList.remove('combo-pop');
                void c2.offsetWidth;
                c2.classList.add('combo-pop');
            } else {
                c2.style.opacity = 0;
            }
        }

        // <--- ‰øÆÊîπÁÇπÔºöÊó†ÂºπÁ™óÁªìÁÆó
        function endGame(playerDied) {
            gameActive = false;
            setTimeout(() => {
                if(playerDied) {
                    titleText.innerText = "GAME OVER";
                    titleText.style.color = "red";
                    subText.innerText = "ËÉúË¥•‰πÉÂÖµÂÆ∂Â∏∏‰∫ãÔºåÂ∞ë‰æ†ËØ∑ÈáçÊñ∞Êù•Ëøá";
                } else {
                    titleText.innerText = "YOU WIN!";
                    titleText.style.color = "#00f2ff";
                    subText.innerText = "Â§©ÊâçËà¨ÁöÑÊìç‰ΩúÔºÅAIÂ∑≤Ë¢´‰Ω†ÊâìÊúçÔºÅ";
                }
                startBtn.innerText = "üîÑ ÂÜçÊù•‰∏ÄÂ±Ä (‰øùÊåÅÂÖ®Â±è)";
                overlay.style.display = 'flex';
            }, 500);
        }

        function loop() {
            if(!gameActive) return;
            
            let dx = 0, dy = 0;
            if(shake > 0) {
                dx = (Math.random()-0.5) * shake;
                dy = (Math.random()-0.5) * shake;
                shake *= 0.9;
                if(shake < 0.5) shake = 0;
            }

            ctx.save();
            ctx.translate(dx, dy);
            
            canvas.width = window.innerWidth;
            canvas.height = window.innerHeight;
            
            ctx.clearRect(0, 0, canvas.width, canvas.height);
            
            // ËÉåÊôØÁâπÊïà
            ctx.strokeStyle = 'rgba(0, 210, 255, 0.1)';
            ctx.lineWidth = 2;
            for(let i=0; i<canvas.width; i+=50) {
                ctx.beginPath(); ctx.moveTo(i, 0); ctx.lineTo(i, canvas.height); ctx.stroke();
            }
            ctx.fillStyle = '#222';
            ctx.fillRect(0, canvas.height - 100, canvas.width, 100);
            ctx.fillStyle = '#00d2ff';
            ctx.fillRect(0, canvas.height - 100, canvas.width, 2);

            p1.update(p2);
            p2.update(p1);

            for(let i = particles.length-1; i>=0; i--) {
                particles[i].update();
                particles[i].draw();
                if(particles[i].life <= 0) particles.splice(i, 1);
            }

            ctx.restore();
            requestAnimationFrame(loop);
        }

        function initGame() {
            p1 = new Fighter(100, '#00ffaa', false);
            p2 = new Fighter(600, '#ff3333', true);
            particles = [];
            
            // Ê∏ÖÁ©∫UI
            document.getElementById('p1-combo').style.opacity = 0;
            document.getElementById('p2-combo').style.opacity = 0;
            
            gameActive = true;
            updateUI();
            loop();
        }

        startBtn.onclick = async () => {
            try {
                // Â¶ÇÊûúÂ∑≤ÁªèÂú®ÂÖ®Â±èÊ®°ÂºèÔºåÂ∞±‰∏çÈúÄË¶ÅÂÜçËØ∑Ê±Ç‰∫Ü
                if (!document.fullscreenElement) {
                    const de = document.documentElement;
                    if(de.requestFullscreen) await de.requestFullscreen();
                    if(screen.orientation && screen.orientation.lock) await screen.orientation.lock('landscape');
                }
            } catch(e){}
            overlay.style.display = 'none';
            initGame();
        };

        const bindBtn = (id, start, end) => {
            const b = document.getElementById(id);
            const down = (e) => { e.preventDefault(); b.classList.add('pressed'); start(); };
            const up = (e) => { e.preventDefault(); b.classList.remove('pressed'); if(end) end(); };
            b.addEventListener('touchstart', down, {passive:false});
            b.addEventListener('touchend', up, {passive:false});
            b.addEventListener('mousedown', down);
            b.addEventListener('mouseup', up);
        };

        bindBtn('left', () => keys.l=true, () => keys.l=false);
        bindBtn('right', () => keys.r=true, () => keys.r=false);
        bindBtn('btn-jump', () => { if(p1.vy === 0) p1.vy = -20; });
        bindBtn('btn-atk', () => p1.attack(p2));
        bindBtn('btn-dash', () => p1.dash());
        bindBtn('btn-ult', () => p1.ultimate(p2));

    </script>
</body>
</html>