<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>å¤©æ‰å°å¦çš„æ ¼æ–—(æ‰‹æœºç‰ˆ)</title>
    <style>
        /* è¿™é‡Œçš„CSSæ˜¯ä¸ºäº†é˜²æ­¢æ‰‹æœºå„ç§é»˜è®¤è¡Œä¸ºï¼Œæ¯”å¦‚é•¿æŒ‰é€‰ä¸­ã€åŒå‡»ç¼©æ”¾ */
        body { 
            margin: 0; 
            background: #111; 
            overflow: hidden; 
            font-family: sans-serif; 
            touch-action: none; /* å…³é”®ï¼šç¦æ­¢æµè§ˆå™¨é»˜è®¤æ‰‹åŠ¿ */
            user-select: none;
            -webkit-user-select: none;
        }
        
        #game-container {
            position: relative;
            width: 100vw;
            height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
            background: #222;
        }

        canvas { 
            background: #333; 
            border: 2px solid #00d2ff; 
            max-width: 100%;
            max-height: 80%; /* ç•™å‡ºç©ºé—´ç»™æŒ‰é’® */
        }

        #ui { 
            position: absolute; 
            top: 10px; 
            width: 90%; 
            display: flex; 
            justify-content: space-between; 
            font-size: 18px; 
            font-weight: bold; 
            z-index: 10;
            pointer-events: none; /* è®©ç‚¹å‡»ç©¿é€UIå±‚ */
        }

        /* å…¨å±æŒ‰é’® */
        #fs-btn {
            position: absolute;
            top: 10px;
            left: 50%;
            transform: translateX(-50%);
            padding: 5px 15px;
            background: #00d2ff;
            color: black;
            border: none;
            border-radius: 5px;
            font-weight: bold;
            z-index: 20;
            pointer-events: auto;
        }

        /* è™šæ‹Ÿæ‰‹æŸ„åŒºåŸŸ */
        .controls {
            position: absolute;
            bottom: 20px;
            width: 100%;
            height: 120px;
            pointer-events: none; /* åªæœ‰æŒ‰é’®æ¥å—ç‚¹å‡» */
            display: flex;
            justify-content: space-between;
            padding: 0 20px;
            box-sizing: border-box;
        }

        .btn-group {
            display: flex;
            gap: 15px;
            pointer-events: auto;
        }

        .btn {
            width: 70px;
            height: 70px;
            background: rgba(255, 255, 255, 0.15);
            border: 2px solid rgba(255, 255, 255, 0.5);
            border-radius: 50%;
            display: flex;
            justify-content: center;
            align-items: center;
            color: white;
            font-size: 24px;
            touch-action: none;
        }

        .btn:active { background: rgba(0, 210, 255, 0.4); transform: scale(0.95); }
        .rect-btn { border-radius: 15px; width: 80px; }
        
        /* ç«–å±æç¤º */
        #rotate-msg {
            display: none;
            position: absolute; top:0; left:0; width:100%; height:100%;
            background: black; color: white; z-index: 999;
            justify-content: center; align-items: center; text-align: center;
        }
        
        @media screen and (orientation: portrait) {
            #rotate-msg { display: flex; }
        }
    </style>
</head>
<body>

    <div id="rotate-msg">è¯·æŠŠæ‰‹æœºæ¨ªè¿‡æ¥ç©ï¼<br>(Turn device landscape)</div>

    <div id="game-container">
        <button id="fs-btn">ğŸ–¥ï¸ å…¨å±æ¨¡å¼ (é˜²æ­¢è¯¯è§¦)</button>

        <div id="ui">
            <div style="color: #00ff00">YOU: <span id="p1Health">100</span></div>
            <div style="color: #ff0000">AI: <span id="p2Health">100</span></div>
        </div>
        
        <canvas id="gameCanvas" width="800" height="400"></canvas>

        <!-- è™šæ‹Ÿæ‰‹æŸ„ -->
        <div class="controls">
            <!-- å·¦ä¾§ç§»åŠ¨ -->
            <div class="btn-group" style="align-items: flex-end;">
                <div class="btn" id="btn-left">â¬…ï¸</div>
                <div class="btn" id="btn-right">â¡ï¸</div>
            </div>
            <!-- å³ä¾§åŠ¨ä½œ -->
            <div class="btn-group" style="align-items: flex-end;">
                <div class="btn" id="btn-jump">â¬†ï¸</div>
                <div class="btn rect-btn" id="btn-atk" style="background: rgba(255,0,0,0.2);">ğŸ¥Š</div>
            </div>
        </div>
    </div>

    <script>
        const canvas = document.getElementById('gameCanvas');
        const ctx = canvas.getContext('2d');
        const fsBtn = document.getElementById('fs-btn');
        
        // å…¨å±é€»è¾‘
        fsBtn.addEventListener('click', () => {
            const elem = document.documentElement;
            if (elem.requestFullscreen) {
                elem.requestFullscreen();
            } else if (elem.webkitRequestFullscreen) { /* Safari */
                elem.webkitRequestFullscreen();
            } else if (elem.msRequestFullscreen) { /* IE11 */
                elem.msRequestFullscreen();
            }
            fsBtn.style.display = 'none'; // ç‚¹å®Œéšè—æŒ‰é’®
        });

        // æ ¸å¿ƒå˜é‡
        const keys = { a: false, d: false, w: false };
        
        // æ¸¸æˆç‰©ä½“ç±» (å¤ç”¨ä¹‹å‰çš„é€»è¾‘ï¼Œè°ƒæ•´äº†é€Ÿåº¦é€‚é…æ‰‹æœº)
        class Fighter {
            constructor(x, color, isAi = false) {
                this.x = x; this.y = 200; this.w = 50; this.h = 100;
                this.color = color; this.dy = 0; this.health = 100;
                this.isAttacking = false; 
                this.isAi = isAi; this.speed = 4; // æ‰‹æœºä¸Šç¨å¾®æ…¢ä¸€ç‚¹ç‚¹æ›´å®¹æ˜“æ§åˆ¶
                this.ground = 250; // åœ°é¢é«˜åº¦
            }

            update(target) {
                this.y += this.dy;
                // ç®€å•çš„ç‰©ç†å¼•æ“
                if (this.y + this.h + this.dy >= canvas.height - 20) { 
                    this.dy = 0; 
                    this.y = canvas.height - 20 - this.h; 
                } else { 
                    this.dy += 0.6; // é‡åŠ›
                }

                // AI é€»è¾‘
                if (this.isAi && this.health > 0) {
                    if (target.x > this.x + 40) this.x += 2.5;
                    else if (target.x < this.x - 40) this.x -= 2.5;
                    // AIè·³è·ƒ
                    if (target.y < this.y - 50 && this.dy === 0 && Math.random() < 0.05) this.dy = -15;
                    // AIæ”»å‡»
                    if (Math.abs(target.x - this.x) < 90 && Math.abs(target.y - this.y) < 50 && Math.random() < 0.03) this.attack(target);
                }
                this.draw();
            }

            draw() {
                if (this.health <= 0) return; // æ­»äº†å°±ä¸ç”»äº†
                ctx.fillStyle = this.color;
                ctx.fillRect(this.x, this.y, this.w, this.h);
                
                // çœ¼ç› (è£…é¥°)
                ctx.fillStyle = 'white';
                let eyeOffset = this.isAi ? 10 : 30; 
                ctx.fillRect(this.x + eyeOffset, this.y + 20, 10, 10);

                if (this.isAttacking) {
                    ctx.fillStyle = 'yellow';
                    let attackX = this.x > 400 ? this.x - 60 : this.x + this.w; // ç®€å•åˆ¤æ–­æœå‘
                    // ä¸ºäº†ç®€åŒ–ï¼Œç©å®¶æ°¸è¿œå‘å³æ‰“ï¼Œæ•Œäººæ°¸è¿œå‘å·¦æ‰“ï¼ˆé™¤éä½ è·‘åˆ°æ•ŒäººèƒŒé¢ï¼Œè¿™é‡Œå·æ‡’äº†å“ˆï¼‰
                    if(!this.isAi) attackX = this.x + this.w;
                    else attackX = this.x - 60;
                    
                    ctx.fillRect(attackX, this.y + 30, 60, 30);
                }
            }

            attack(target) {
                if(this.isAttacking || this.health <= 0) return;
                this.isAttacking = true;
                setTimeout(() => this.isAttacking = false, 150);

                // ç¢°æ’æ£€æµ‹
                let attackX = this.isAi ? this.x - 60 : this.x + this.w;
                // æå…¶ç®€å•çš„åˆ¤å®š
                if (attackX < target.x + target.w &&
                    attackX + 60 > target.x &&
                    this.y < target.y + target.h &&
                    this.y + 100 > target.y) {
                    
                    target.health -= 5; // æ‰‹æœºç‰ˆä¼¤å®³è°ƒä½ä¸€ç‚¹ï¼Œå¤šæ‰“å‡ ä¸‹
                    if(target.health < 0) target.health = 0;
                    updateUI();
                }
            }
        }

        const player = new Fighter(100, '#00ff00');
        const enemy = new Fighter(600, '#ff0000', true);

        // --- è§¦å±æ§åˆ¶é€»è¾‘ ---
        function setupTouch(id, key, type) {
            const btn = document.getElementById(id);
            btn.addEventListener('touchstart', (e) => { e.preventDefault(); action(key, true); });
            btn.addEventListener('touchend', (e) => { e.preventDefault(); action(key, false); });
            // å…¼å®¹é¼ æ ‡ç‚¹å‡»æµ‹è¯•
            btn.addEventListener('mousedown', (e) => { action(key, true); });
            btn.addEventListener('mouseup', (e) => { action(key, false); });
        }

        function action(key, pressed) {
            if (key === 'left') keys.a = pressed;
            if (key === 'right') keys.d = pressed;
            if (key === 'jump' && pressed) {
                if(player.dy === 0) player.dy = -15; 
            }
            if (key === 'atk' && pressed) player.attack(enemy);
        }

        setupTouch('btn-left', 'left');
        setupTouch('btn-right', 'right');
        setupTouch('btn-jump', 'jump');
        setupTouch('btn-atk', 'atk');

        // --- æ¸¸æˆå¾ªç¯ ---
        function updateUI() {
            document.getElementById('p1Health').innerText = player.health;
            document.getElementById('p2Health').innerText = enemy.health;
            if(player.health <= 0) alert("GAME OVER! ä½ è¢«AIæ‰“çˆ†äº†ï¼åˆ·æ–°é‡æ¥ï¼");
            if(enemy.health <= 0) alert("K.O.! å¤©æ‰ï¼ä½ èµ¢äº†ï¼");
        }

        function animate() {
            window.requestAnimationFrame(animate);
            // é€‚é…å±å¹•å°ºå¯¸
            canvas.width = window.innerWidth > 800 ? 800 : window.innerWidth; 
            canvas.height = window.innerHeight > 400 ? 400 : window.innerHeight * 0.8;
            
            // æ¸…ç©ºç”»å¸ƒ
            ctx.fillStyle = '#222';
            ctx.fillRect(0, 0, canvas.width, canvas.height);
            
            // åœ°é¢
            ctx.fillStyle = '#1a1a1a';
            ctx.fillRect(0, canvas.height - 20, canvas.width, 20);

            if(player.health > 0) {
                if (keys.d && player.x < canvas.width - player.w) player.x += player.speed;
                if (keys.a && player.x > 0) player.x -= player.speed;
                player.update(enemy);
            }
            
            enemy.update(player);
        }

        animate();
    </script>
</body>
</html>