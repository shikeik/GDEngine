<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>å¤©æ‰æ ¼æ–—å®‰å“ç‰¹ä¾›ç‰ˆ</title>
    <style>
        /* åŸºç¡€è®¾ç½®ï¼šç¦æ­¢ä¸€åˆ‡é»˜è®¤æ‰‹åŠ¿ */
        body { 
            margin: 0; background: #000; overflow: hidden; 
            font-family: 'Segoe UI', sans-serif; 
            touch-action: none; user-select: none; -webkit-user-select: none;
        }
        
        #game-container {
            position: absolute; top: 0; left: 0; width: 100%; height: 100%;
            background: #222;
        }

        canvas { display: block; width: 100%; height: 100%; }

        /* UIå±‚ï¼šè¡€æ¡ */
        #ui-layer { 
            position: absolute; top: 10px; left: 2%; width: 96%; 
            display: flex; justify-content: space-between; z-index: 5; pointer-events: none; 
        }
        .bar-wrap { width: 45%; height: 15px; background: #444; border: 2px solid #fff; transform: skewX(-15deg); }
        .hp { height: 100%; transition: width 0.1s; }
        #p1-hp { background: #0f0; width: 100%; float: right; }
        #p2-hp { background: #f00; width: 100%; float: left; }

        /* è¦†ç›–å±‚ï¼šå¼€å§‹æŒ‰é’® & ç»“ç®—ä¿¡æ¯ */
        #overlay {
            position: absolute; top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(0,0,0,0.9); z-index: 999;
            display: flex; flex-direction: column; justify-content: center; align-items: center;
        }
        
        #status-text { 
            color: #00d2ff; font-size: 30px; font-weight: bold; margin-bottom: 30px; 
            text-shadow: 0 0 10px #00d2ff; text-align: center;
        }

        /* è¶…å¤§æŒ‰é’®ï¼Œç»å¯¹å¥½ç‚¹ */
        #start-btn {
            background: linear-gradient(45deg, #00d2ff, #007aff);
            border: 2px solid #fff; padding: 20px 50px;
            color: white; font-size: 24px; font-weight: bold; border-radius: 50px;
            box-shadow: 0 0 20px rgba(0, 210, 255, 0.6);
            cursor: pointer; active: scale(0.9);
        }
        #start-btn:active { transform: scale(0.95); background: #fff; color: #000; }

        /* è™šæ‹Ÿæ‰‹æŸ„ */
        .controls {
            position: absolute; bottom: 20px; width: 100%; height: 120px;
            display: flex; justify-content: space-between; padding: 0 30px; box-sizing: border-box;
            pointer-events: none; z-index: 10;
        }
        .group { display: flex; gap: 20px; pointer-events: auto; align-items: flex-end; }
        
        .btn {
            width: 70px; height: 70px; border-radius: 50%;
            background: rgba(255,255,255,0.15); border: 2px solid rgba(255,255,255,0.4);
            display: flex; justify-content: center; align-items: center;
            font-size: 30px; color: white;
        }
        .btn.pressed { background: rgba(255,255,255,0.5); transform: scale(0.9); }
        
        #btn-atk { background: rgba(255, 50, 50, 0.3); border-color: #ff5555; }
        #btn-jump { background: rgba(50, 50, 255, 0.3); border-color: #5555ff; }

    </style>
</head>
<body>

    <div id="game-container">
        <!-- æ— è®ºæ¨ªå±ç«–å±ï¼Œè¿™ä¸ªç•Œé¢æ°¸è¿œç½®é¡¶æ˜¾ç¤º -->
        <div id="overlay">
            <div id="status-text">å®‰å“æ ¼æ–—Â·æé€Ÿç‰ˆ</div>
            <button id="start-btn">ğŸš€ å¼€å¯å…¨å± & è‡ªåŠ¨æ—‹è½¬</button>
        </div>

        <div id="ui-layer">
            <div class="bar-wrap"><div id="p1-hp" class="hp"></div></div>
            <div style="color:#fff; font-weight:bold;">VS</div>
            <div class="bar-wrap"><div id="p2-hp" class="hp"></div></div>
        </div>

        <canvas id="canvas"></canvas>

        <div class="controls">
            <div class="group">
                <div class="btn" id="left">â¬…ï¸</div>
                <div class="btn" id="right">â¡ï¸</div>
            </div>
            <div class="group">
                <div class="btn" id="atk">ğŸ¥Š</div>
                <div class="btn" id="jump">ğŸš€</div>
            </div>
        </div>
    </div>

    <script>
        const canvas = document.getElementById('canvas');
        const ctx = canvas.getContext('2d');
        const overlay = document.getElementById('overlay');
        const startBtn = document.getElementById('start-btn');
        const statusText = document.getElementById('status-text');
        
        let p1, p2, animationId;
        const keys = { l: false, r: false };

        // æŒ‰é’®ç‚¹å‡»ï¼šå…¨å± + é”æ¨ªå±
        startBtn.onclick = async () => {
            try {
                // 1. è¯·æ±‚å…¨å±
                const docEl = document.documentElement;
                if (docEl.requestFullscreen) await docEl.requestFullscreen();
                else if (docEl.webkitRequestFullscreen) await docEl.webkitRequestFullscreen();
                
                // 2. å®‰å“å¼ºåŠ›é”æ¨ªå± (å¿…é¡»åœ¨å…¨å±åè°ƒç”¨)
                if (screen.orientation && screen.orientation.lock) {
                    await screen.orientation.lock('landscape').catch(e => console.log('æ—‹è½¬å¤±è´¥ï¼Œå¯èƒ½æ˜¯æµè§ˆå™¨é™åˆ¶', e));
                }
            } catch (err) {
                console.log("å…¨å±è¯·æ±‚æœ‰ç‚¹é—®é¢˜ï¼Œä¸è¿‡ä¸å½±å“ç©", err);
            }
            
            // 3. å¼€å§‹æ¸¸æˆ
            startGame();
        };

        // æ¸¸æˆé€»è¾‘
        class Box {
            constructor(x, color, ai) {
                this.startPos = x; this.c = color; this.ai = ai;
                this.reset();
            }
            reset() {
                this.x = this.startPos; this.y = 200; this.w = 50; this.h = 90;
                this.dy = 0; this.hp = 100; this.atk = false; this.dir = this.ai ? -1 : 1;
                this.dead = false;
            }
            update(target) {
                if(this.dead) return;
                
                // ç‰©ç†
                this.y += this.dy;
                let ground = canvas.height - 120; // åœ°é¢é«˜åº¦
                if(this.y + this.h >= ground) { this.y = ground - this.h; this.dy = 0; }
                else this.dy += 0.9;

                // è¡Œä¸º
                if(!this.ai) {
                    if(keys.l && this.x > 0) { this.x -= 5; this.dir = -1; }
                    if(keys.r && this.x < canvas.width - this.w) { this.x += 5; this.dir = 1; }
                } else {
                    // ç®€å•çš„AI
                    let dist = Math.abs(this.x - target.x);
                    this.dir = this.x < target.x ? 1 : -1;
                    if(dist > 60) this.x += 3 * this.dir;
                    if(dist < 100 && Math.random() < 0.03) this.hit(target);
                    if(target.y < this.y - 50 && this.dy === 0 && Math.random() < 0.05) this.dy = -15;
                }
                
                this.draw();
            }
            draw() {
                ctx.fillStyle = this.c;
                ctx.fillRect(this.x, this.y, this.w, this.h);
                
                // çœ¼ç›
                ctx.fillStyle = '#fff';
                ctx.fillRect(this.x + (this.dir===1?30:10), this.y+20, 10, 10);
                
                // æ”»å‡»æ¡†
                if(this.atk) {
                    ctx.fillStyle = 'yellow';
                    let ax = this.dir===1 ? this.x+this.w : this.x-60;
                    ctx.fillRect(ax, this.y+30, 60, 30);
                }
            }
            hit(target) {
                if(this.atk || this.dead) return;
                this.atk = true;
                setTimeout(() => this.atk = false, 150);
                
                let ax = this.dir===1 ? this.x+this.w : this.x-60;
                // ç¢°æ’
                if(ax < target.x + target.w && ax + 60 > target.x && 
                   this.y < target.y + target.h && this.y+30 > target.y) {
                    target.hp -= 10;
                    updateUI();
                    if(target.hp <= 0) gameOver(this.ai ? "èœå°±å¤šç»ƒï¼(è´¥)" : "å¤©æ‰æ“ä½œï¼(èƒœ)");
                }
            }
        }

        function startGame() {
            overlay.style.display = 'none';
            if(!p1) {
                p1 = new Box(100, '#0f0', false);
                p2 = new Box(600, '#f00', true);
                loop();
            } else {
                p1.reset(); p2.reset();
                updateUI();
                cancelAnimationFrame(animationId);
                loop();
            }
        }

        function loop() {
            // å®æ—¶é€‚é…å±å¹•å°ºå¯¸
            canvas.width = window.innerWidth;
            canvas.height = window.innerHeight;
            
            ctx.fillStyle = '#222';
            ctx.fillRect(0, 0, canvas.width, canvas.height);
            
            // ç”»åœ°é¢
            ctx.fillStyle = '#333';
            ctx.fillRect(0, canvas.height - 120, canvas.width, 120);

            p1.update(p2);
            p2.update(p1);
            animationId = requestAnimationFrame(loop);
        }

        function updateUI() {
            document.getElementById('p1-hp').style.width = Math.max(0, p1.hp) + '%';
            document.getElementById('p2-hp').style.width = Math.max(0, p2.hp) + '%';
        }

        function gameOver(msg) {
            statusText.innerText = msg;
            startBtn.innerText = "ğŸ”„ ä¸æœï¼Ÿå†æ¥ï¼";
            overlay.style.display = 'flex';
        }

        // è§¦æ§ç»‘å®š
        function bind(id, pressFn, releaseFn) {
            let b = document.getElementById(id);
            const start = (e) => { e.preventDefault(); b.classList.add('pressed'); pressFn(); };
            const end = (e) => { e.preventDefault(); b.classList.remove('pressed'); if(releaseFn) releaseFn(); };
            b.addEventListener('touchstart', start, {passive:false});
            b.addEventListener('touchend', end, {passive:false});
            b.addEventListener('mousedown', start);
            b.addEventListener('mouseup', end);
        }

        bind('left', () => keys.l=true, () => keys.l=false);
        bind('right', () => keys.r=true, () => keys.r=false);
        bind('atk', () => p1.hit(p2));
        bind('jump', () => { if(p1.dy===0) p1.dy = -18; });

    </script>
</body>
</html>